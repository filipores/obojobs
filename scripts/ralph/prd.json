{
  "project": "obojobs",
  "branchName": "ralph/production-auth",
  "description": "Produktionsreifes Authentifizierungs-System mit Email-Verifizierung, Passwort-Reset und Security-Features",
  "userStories": [
    {
      "id": "AUTH-001",
      "title": "Passwort-Stärke Validierung",
      "description": "Backend und Frontend sollen sichere Passwörter erzwingen",
      "acceptanceCriteria": [
        "Backend: Passwort muss min. 8 Zeichen haben",
        "Backend: Passwort muss Groß-, Kleinbuchstaben und Zahl enthalten",
        "Backend: Gibt spezifische Fehlermeldung zurück welche Regel verletzt wurde",
        "Frontend: Zeigt Passwort-Anforderungen beim Registrieren an",
        "Frontend: Live-Feedback während Eingabe (welche Regeln erfüllt/nicht erfüllt)",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 1,
      "passes": false,
      "notes": "Validierung als eigene Funktion in services/ für Wiederverwendung"
    },
    {
      "id": "AUTH-002",
      "title": "Email-Verifizierung: Backend Token-System",
      "description": "Backend generiert Verifizierungs-Tokens und speichert Verifizierungs-Status",
      "acceptanceCriteria": [
        "User Model: Neues Feld 'email_verified' (Boolean, default False)",
        "User Model: Neues Feld 'email_verification_token' (String, nullable)",
        "User Model: Neues Feld 'email_verification_sent_at' (DateTime, nullable)",
        "Migration für neue Felder erstellt und angewendet",
        "Service-Funktion zum Generieren eines sicheren Tokens (secrets.token_urlsafe)",
        "Token läuft nach 24 Stunden ab",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Noch kein Email-Versand - nur Token-Logik"
    },
    {
      "id": "AUTH-003",
      "title": "Email-Verifizierung: API Endpoints",
      "description": "Endpoints für Token-Versand und Verifizierung",
      "acceptanceCriteria": [
        "POST /api/auth/send-verification - Sendet neuen Verifizierungs-Token (logged in)",
        "POST /api/auth/verify-email - Verifiziert Email mit Token",
        "GET /api/auth/me gibt 'email_verified' Status zurück",
        "Rate Limiting: Max 3 Verification-Emails pro Stunde",
        "Tests für alle neuen Endpoints",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Email-Versand wird geloggt statt wirklich gesendet (für Dev)"
    },
    {
      "id": "AUTH-004",
      "title": "Email-Verifizierung: Frontend Flow",
      "description": "UI für Email-Verifizierung nach Registrierung",
      "acceptanceCriteria": [
        "Nach Registrierung: Weiterleitung zu 'Email verifizieren' Seite",
        "Seite zeigt: 'Verifizierungs-Email wurde gesendet an [email]'",
        "Button: 'Erneut senden' (mit Cooldown-Anzeige)",
        "Route /verify-email?token=xxx für Verifizierung",
        "Erfolg: Toast + Weiterleitung zum Dashboard",
        "Fehler: Klare Fehlermeldung (Token abgelaufen, ungültig, etc.)",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Banner im Dashboard wenn Email noch nicht verifiziert"
    },
    {
      "id": "AUTH-005",
      "title": "Passwort-Reset: Backend Token-System",
      "description": "Backend für Passwort-Vergessen Funktion",
      "acceptanceCriteria": [
        "User Model: Neues Feld 'password_reset_token' (String, nullable)",
        "User Model: Neues Feld 'password_reset_sent_at' (DateTime, nullable)",
        "Migration für neue Felder",
        "POST /api/auth/forgot-password - Generiert Reset-Token (public)",
        "POST /api/auth/reset-password - Setzt neues Passwort mit Token",
        "Token läuft nach 1 Stunde ab",
        "Rate Limiting: Max 3 Reset-Requests pro Stunde pro Email",
        "Tests für alle Endpoints",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Gibt immer 200 OK zurück (verhindert Email-Enumeration)"
    },
    {
      "id": "AUTH-006",
      "title": "Passwort-Reset: Frontend Flow",
      "description": "UI für Passwort-Vergessen Funktion",
      "acceptanceCriteria": [
        "Link 'Passwort vergessen?' auf Login-Seite",
        "Seite /forgot-password mit Email-Eingabe",
        "Nach Submit: 'Falls Email existiert, wurde Link gesendet'",
        "Seite /reset-password?token=xxx für neues Passwort",
        "Passwort-Stärke Validierung (wie bei Registrierung)",
        "Erfolg: Toast + Weiterleitung zu Login",
        "Fehler: Klare Fehlermeldung",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "AUTH-007",
      "title": "Account-Sperre bei Fehlversuchen",
      "description": "Temporäre Sperre nach zu vielen fehlgeschlagenen Login-Versuchen",
      "acceptanceCriteria": [
        "User Model: Neues Feld 'failed_login_attempts' (Integer, default 0)",
        "User Model: Neues Feld 'locked_until' (DateTime, nullable)",
        "Nach 5 Fehlversuchen: Account für 15 Minuten gesperrt",
        "Login-Endpoint prüft Sperre und gibt entsprechende Meldung",
        "Erfolgreicher Login setzt failed_attempts auf 0",
        "Tests für Lockout-Logik",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 7,
      "passes": false,
      "notes": "Sperre ist zeitbasiert, kein Admin-Unlock nötig"
    },
    {
      "id": "AUTH-008",
      "title": "Passwort ändern (eingeloggt)",
      "description": "Eingeloggte User können ihr Passwort ändern",
      "acceptanceCriteria": [
        "PUT /api/auth/change-password Endpoint",
        "Erfordert: current_password, new_password",
        "Validiert aktuelles Passwort",
        "Validiert neues Passwort (Stärke-Regeln)",
        "Frontend: Formular in Settings-Seite",
        "Erfolg: Toast 'Passwort geändert'",
        "Tests für Endpoint",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "AUTH-009",
      "title": "Logout Endpoint",
      "description": "Expliziter Logout mit Token-Invalidierung",
      "acceptanceCriteria": [
        "POST /api/auth/logout Endpoint",
        "Fügt aktuellen Token zu Blacklist hinzu (oder nutzt Token-Version)",
        "Neues Model oder Redis-Cache für Token-Blacklist",
        "JWT-Middleware prüft Blacklist",
        "Frontend: Logout-Button ruft Endpoint auf vor localStorage-Clear",
        "Test für Logout-Funktionalität",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 9,
      "passes": false,
      "notes": "Einfache DB-Blacklist ist OK für MVP, Redis später"
    },
    {
      "id": "AUTH-010",
      "title": "Security Headers & HTTPS-Redirect",
      "description": "Sicherheits-Header für Production",
      "acceptanceCriteria": [
        "Middleware für Security Headers (X-Content-Type-Options, X-Frame-Options, etc.)",
        "HSTS Header wenn HTTPS aktiv",
        "CORS korrekt konfiguriert für Production-Domain",
        "Secure & HttpOnly Flags für Cookies (falls verwendet)",
        "Dokumentation in AGENTS.md aktualisiert",
        "Alle Tests grün, Linting OK"
      ],
      "priority": 10,
      "passes": false,
      "notes": "Headers nur in Production aktivieren, nicht in Dev"
    }
  ]
}
