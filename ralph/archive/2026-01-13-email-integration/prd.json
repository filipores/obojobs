{
  "project": "obojobs",
  "branchName": "ralph/stripe-saas",
  "description": "Stripe Subscription System - Monatliche Abos mit Feature-Limits pro Plan",
  "userStories": [
    {
      "id": "STRIPE-001",
      "title": "Stripe SDK Setup",
      "description": "Stripe Libraries und Konfiguration einrichten",
      "acceptanceCriteria": [
        "stripe Python Library in requirements.txt",
        "Environment Variables: STRIPE_SECRET_KEY, STRIPE_PUBLISHABLE_KEY, STRIPE_WEBHOOK_SECRET",
        "Neuer Service: backend/services/stripe_service.py mit Stripe Client",
        "Frontend: Stripe.js via CDN oder npm package",
        "Test-Modus Konfiguration für Development",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 1,
      "passes": false,
      "notes": "stripe>=7.0.0 für aktuelle API"
    },
    {
      "id": "STRIPE-002",
      "title": "Subscription Model",
      "description": "Datenbank-Model für Subscriptions",
      "acceptanceCriteria": [
        "Neues Model: Subscription (user_id, stripe_customer_id, stripe_subscription_id, plan, status, current_period_start, current_period_end, created_at)",
        "Plan-Enum: free, basic, pro",
        "Status-Enum: active, canceled, past_due, trialing",
        "User Model: Neue Felder stripe_customer_id, subscription_id (FK)",
        "Migration für alle neuen Felder/Models",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 2,
      "passes": false,
      "notes": "One-to-One Relationship User ↔ Subscription"
    },
    {
      "id": "STRIPE-003",
      "title": "Stripe Products & Prices",
      "description": "Produkte und Preise in Stripe anlegen und abrufen",
      "acceptanceCriteria": [
        "GET /api/subscriptions/plans - Listet verfügbare Pläne",
        "Pläne: Free (€0, 3 Bewerbungen/Monat), Basic (€9.99, 20 Bewerbungen/Monat), Pro (€19.99, unbegrenzt)",
        "Stripe Product IDs in Environment Variables oder Config",
        "Response enthält: plan_id, name, price, features[], limits",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Products manuell in Stripe Dashboard anlegen, IDs in .env"
    },
    {
      "id": "STRIPE-004",
      "title": "Checkout Flow",
      "description": "Stripe Checkout Session für Abo-Kauf",
      "acceptanceCriteria": [
        "POST /api/subscriptions/create-checkout - Erstellt Stripe Checkout Session",
        "Parameter: plan (basic/pro), success_url, cancel_url",
        "Erstellt Stripe Customer falls noch nicht vorhanden",
        "Speichert stripe_customer_id am User",
        "Frontend: Redirect zu Stripe Checkout",
        "Success Page nach Kauf",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Stripe Checkout hosted page für PCI Compliance"
    },
    {
      "id": "STRIPE-005",
      "title": "Webhook Handler",
      "description": "Stripe Webhooks für Subscription-Events",
      "acceptanceCriteria": [
        "POST /api/webhooks/stripe - Webhook Endpoint",
        "Signature Verification mit STRIPE_WEBHOOK_SECRET",
        "Events: checkout.session.completed, customer.subscription.created, customer.subscription.updated, customer.subscription.deleted",
        "Subscription Model wird bei Events aktualisiert",
        "Logging für alle Webhook-Events",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Webhook Endpoint muss public sein (kein JWT)"
    },
    {
      "id": "STRIPE-006",
      "title": "Feature Gating & Limits",
      "description": "Nutzungslimits pro Subscription-Plan",
      "acceptanceCriteria": [
        "User Model: Neues Feld applications_this_month (Integer, default 0)",
        "User Model: Neues Feld month_reset_at (DateTime)",
        "Middleware/Decorator: check_subscription_limit()",
        "Free: Max 3 Bewerbungen/Monat, Basic: 20, Pro: unbegrenzt",
        "Bei Limit erreicht: 403 mit klarer Fehlermeldung",
        "Counter wird am Monatsanfang zurückgesetzt",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 6,
      "passes": false,
      "notes": "Reset via Webhook oder bei nächstem Request prüfen"
    },
    {
      "id": "STRIPE-007",
      "title": "Billing Portal & UI",
      "description": "Frontend für Subscription-Verwaltung",
      "acceptanceCriteria": [
        "Neue View: SubscriptionView.vue oder Sektion in Settings",
        "Zeigt: Aktueller Plan, Nutzung (X/Y Bewerbungen), nächste Abrechnung",
        "POST /api/subscriptions/portal - Erstellt Stripe Portal Session",
        "Button: 'Abo verwalten' → Stripe Customer Portal",
        "Upgrade/Downgrade über Stripe Portal",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 7,
      "passes": false,
      "notes": "Stripe Portal für Self-Service (Kündigung, Zahlungsmethode)"
    },
    {
      "id": "STRIPE-008",
      "title": "Legacy Payment System entfernen",
      "description": "PayPal und Credit-System vollständig entfernen",
      "acceptanceCriteria": [
        "Entfernt: backend/routes/payments.py (PayPal routes)",
        "Entfernt: backend/services/paypal_service.py",
        "Entfernt: Purchase Model und Migration",
        "User Model: credits_remaining, credits_max, total_credits_purchased entfernen",
        "Frontend: BuyCreditsView.vue entfernen oder zu SubscriptionView umbauen",
        "Alle Referenzen auf Credits entfernen",
        "AGENTS.md aktualisieren",
        "Alle Tests grün (pytest, npm test)",
        "Linting OK (ruff, eslint)"
      ],
      "priority": 8,
      "passes": false,
      "notes": "Erst nach vollständiger Stripe-Integration entfernen"
    }
  ]
}
